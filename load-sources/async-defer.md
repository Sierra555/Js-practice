Коли браузер завантажує HTML і зустрічає скріпт, він не може продовжувати будівництво DOM. Він повинен виконати скрипт прямо зараз.

Це призводить до двох важливих проблем:

Скрипти не можуть бачити елементи DOM під ними, тому вони не можуть додавати обробники тощо.
Якщо у верхній частині сторінки є громіздкий скрипт, він “блокує сторінку”. Користувачі не можуть побачити вміст сторінки, поки він не завантажиться та не запуститься.

Ми можемо розмістити скрипт внизу сторінки. Тоді він зможе бачити елементи над ним і не блокуватиме показ вмісту сторінки.Але це рішення далеко не ідеальне. Наприклад, браузер помічає скрипт (і може почати його завантаження) лише після того, як повністю завантажить HTML-документ.

##### defer
Атрибут defer повідомляє браузеру, що йому не треба чекати на скрипт. Замість цього браузер продовжить обробляти HTML, будувати DOM. Скрипт завантажується “у фоновому режимі”, а потім запускається, коли DOM повністю побудовано.

- Скрипти з defer ніколи не блокують сторінку.
- Скрипти з defer завжди виконуються, коли DOM готово (але перед подією DOMContentLoaded).
- Атрибут defer призначений лише для зовнішніх скриптів
- трибут defer ігнорується, якщо тег script не має src.

Але атрибут defer, крім того, що каже браузеру “не блокувати”, гарантує, що зберігається відносний порядок виконання. Тому навіть якщо small.js завантажується першим, він все ще чекає і запускається після виконання long.js.

Це може бути важливим в тих випадках, коли нам потрібно завантажити бібліотеку JavaScript, а потім скрипт, який залежить від неї.

##### async

Атрибут async означає, що скрипт повністю незалежний:

- Браузер не блокує async скрипти (як defer).
- Інші скрипти не чекають async скриптів, а async скрипти не чекають їх.
- DOMContentLoaded та асинхронні скрипти не чекають один одного:
- DOMContentLoaded може відбуватися як перед асинхронним скриптом (якщо асинхронний скрипт закінчує завантаження після того, як сторінка готова)
…або після асинхронного скрипту (якщо асинхронний скрипт короткий або був у HTTP-кеші)

DOM та інші скрипти їх не чекають, і вони нічого не чекають. Повністю незалежний скрипт, який запускається, коли завантажений.  Іншими словами, асинхронні сценарії виконуються в порядку “першим завантажився – першим виконався”.

Атрибут async – лише для зовнішніх скриптів
Як і defer, атрибут async ігнорується, якщо тег script не має src.

#### Динамічні скрипти

let script = document.createElement('script');
script.src = "/article/script-async-defer/long.js";
document.body.append(script); // (*)

Динамічні скрипти за замовчуванням поводяться як “async”.

Тобто:

- Вони нічого не чекають, їх нічого не чекає.
- Скрипт, який завантажується першим – запускається першим (в порядку “першим завантажився – першим виконався”).
Це можна змінити, якщо ми явно встановимо script.async=false. Тоді скрипти будуть виконуватися в порядку розміщення в документі, як при defer.

Знову ж таки, як і у випадку з defer, порядок має значення, якщо ми хочемо завантажити бібліотеку, а потім інший скрипт, який залежить від неї.



На практиці defer використовується для скриптів, яким потрібен весь DOM, і/або важливий їх відносний порядок виконання.

А async використовується для незалежних скриптів, таких як лічильники або реклама. І їх відносний порядок виконання не має значення.